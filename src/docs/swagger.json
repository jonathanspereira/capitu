{
  "openapi": "3.0.0",
  "info": {
    "title": "API - Capitu",
    "version": "1.4.0",
    "description": "Documentação da API do Aplicativo Capitu com Auth, Users, Books e Recomendações"
  },
  "servers": [
    { "url": "http://localhost:3000", "description": "Servidor de Desenvolvimento" },
    { "url": "https://capitu.onrender.com", "description": "Servidor de Produção" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "name": { "type": "string", "example": "João Silva" },
          "email": { "type": "string", "example": "joao@email.com" }
        }
      },
      "BookResponse": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "title": { "type": "string", "example": "1984" },
          "author": { "type": "string", "example": "George Orwell" },
          "readingStatus": { "type": "string", "enum": ["TO_READ","READING","READ"], "example": "TO_READ" },
          "isFavorite": { "type": "boolean", "example": false },
          "createdAt": { "type": "string", "format": "date-time", "example": "2025-10-28T20:00:00Z" },
          "updatedAt": { "type": "string", "format": "date-time", "example": "2025-10-28T20:00:00Z" },
          "userId": { "type": "integer", "example": 1 }
        }
      },
      "ExternalBook": {
        "type": "object",
        "properties": {
          "title": { "type": "string", "example": "The Lord of the Rings" },
          "author": { "type": "string", "example": "J.R.R. Tolkien" },
          "coverUrl": { "type": "string", "example": "https://covers.openlibrary.org/b/id/258027-L.jpg" },
          "openLibraryWorkKey": { "type": "string", "example": "/works/OL27448W" }
        }
      },
      "BookSuggestion": {
        "type": "object",
        "properties": {
          "title": { "type": "string", "example": "O Hobbit" },
          "author": { "type": "string", "example": "J.R.R. Tolkien" },
          "coverUrl": { "type": "string", "example": "https://covers.openlibrary.org/b/id/823456-L.jpg" },
          "openLibraryData": {
            "type": "object",
            "properties": {
              "title": { "type": "string", "example": "The Hobbit" },
              "author_name": { "type": "array", "items": { "type": "string" }, "example": ["J.R.R. Tolkien"] },
              "first_publish_year": { "type": "integer", "example": 1937 },
              "cover_i": { "type": "integer", "example": 823456 },
              "key": { "type": "string", "example": "/works/OL27447W" }
            }
          }
        }
      },
      "CreateBookRequest": {
        "type": "object",
        "required": ["userId","title","author"],
        "properties": {
          "userId": { "type": "integer", "example": 1 },
          "title": { "type": "string", "example": "1984" },
          "author": { "type": "string", "example": "George Orwell" }
        }
      },
      "UpdateStatusRequest": {
        "type": "object",
        "required": ["bookId","userId","status"],
        "properties": {
          "bookId": { "type": "integer", "example": 1 },
          "userId": { "type": "integer", "example": 1 },
          "status": { "type": "string", "enum": ["TO_READ","READING","READ"], "example": "READING" }
        }
      },
      "ToggleFavoriteRequest": {
        "type": "object",
        "required": ["bookId","userId"],
        "properties": {
          "bookId": { "type": "integer", "example": 1 },
          "userId": { "type": "integer", "example": 1 }
        }
      },
      "CreateUserRequest": {
        "type": "object",
        "required": ["name","email","password"],
        "properties": {
          "name": { "type": "string", "example": "João Silva" },
          "email": { "type": "string", "example": "joao@email.com" },
          "password": { "type": "string", "example": "123456" }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": ["email","password"],
        "properties": {
          "email": { "type": "string", "example": "usuario@email.com" },
          "password": { "type": "string", "example": "123456" }
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "user": { "$ref": "#/components/schemas/User" },
          "token": { "type": "string", "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." }
        }
      },
      "ForgotPasswordRequest": {
        "type": "object",
        "required": ["email"],
        "properties": {
          "email": { "type": "string", "example": "usuario@email.com" }
        }
      },
      "VerifyResetTokenRequest": {
        "type": "object",
        "required": ["email","token"],
        "properties": {
          "email": { "type": "string", "example": "usuario@email.com" },
          "token": { "type": "string", "example": "123456" }
        }
      },
      "ResetPasswordRequest": {
        "type": "object",
        "required": ["email","token","newPassword"],
        "properties": {
          "email": { "type": "string", "example": "usuario@email.com" },
          "token": { "type": "string", "example": "123456" },
          "newPassword": { "type": "string", "example": "NovaSenha123" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": { "message": { "type": "string", "example": "Descrição detalhada do erro." } }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/v1/api/register": { "post": { "$ref": "#/paths/register" } },
    "/v1/api/login": { "post": { "$ref": "#/paths/login" } },
    "/v1/api/forgot-password": { "post": { "$ref": "#/paths/forgot-password" } },
    "/v1/api/verify-reset-token": { "post": { "$ref": "#/paths/verify-reset-token" } },
    "/v1/api/reset-password": { "post": { "$ref": "#/paths/reset-password" } },
    "/v1/api/profile": { "get": { "$ref": "#/paths/profile" } },
    "/v1/api/books/search": { "get": { "$ref": "#/paths/books-search" } },
    "/v1/api/books": { "post": { "$ref": "#/paths/books" } },
    "/v1/api/books/status": { "patch": { "$ref": "#/paths/books-status" } },
    "/v1/api/books/favorite": { "patch": { "$ref": "#/paths/books-favorite" } },
    "/v1/api/books/user/{userId}": { "get": { "$ref": "#/paths/books-user" } },
    "/v1/api/recommendations/user/{userId}": {
      "get": {
        "tags": ["Recomendações"],
        "summary": "Gera recomendações de livros para o usuário",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "userId", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "Lista de livros recomendados",
            "content": {
              "application/json": {
                "schema": { "type": "array", "items": { "$ref": "#/components/schemas/BookSuggestion" } }
              }
            }
          },
          "400": {
            "description": "Parâmetro userId inválido",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
          },
          "500": {
            "description": "Erro interno ao gerar recomendações",
            "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } }
          }
        }
      }
    }
  },
  "tags": [
    { "name": "Autenticação", "description": "Endpoints de registro, login e recuperação de senha" },
    { "name": "Usuários", "description": "Gerenciamento de usuários" },
    { "name": "Livros", "description": "Biblioteca do usuário e busca na Open Library" },
    { "name": "Recomendações", "description": "Endpoints de geração de recomendações de livros para usuários" }
  ]
}
